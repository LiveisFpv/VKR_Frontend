import { ref } from 'vue'

export type Locale = 'en' | 'ru'

const STORAGE_KEY = 'app.locale'

function loadLocale(): Locale {
  try {
    const saved = localStorage.getItem(STORAGE_KEY)
    if (saved === 'en' || saved === 'ru') return saved
  } catch {}
  return 'en'
}

export const locale = ref<Locale>(loadLocale())

export function setLocale(next: Locale) {
  locale.value = next
  try {
    localStorage.setItem(STORAGE_KEY, next)
  } catch {}
}

const messages: Record<Locale, Record<string, string>> = {
  en: {
    'nav.addPaper': 'Add Paper',
    'nav.myPapers': 'My Papers',
    'nav.moderation': 'Moderation',
    'nav.adminPanel': 'Admin Panel',
    'nav.newSearch': 'New search',
    'nav.searchChats': 'Search chats',
    'nav.history': 'History',
    'nav.settings': 'Settings',
    'nav.noChats': 'No chats yet. Start a new search.',

    'settings.title': 'Settings',
    'settings.appearance': 'Appearance',
    'settings.dark': 'Dark theme',
    'settings.light': 'Light theme',
    'settings.sidebar': 'Sidebar',
    'settings.hideLeft': 'Hide left panel',
    'settings.language': 'Language',
    'settings.langEnglish': 'English',
    'settings.langRussian': 'Russian',

    'paperAdd.header': 'Add Paper',
    'paperAdd.subtitle': 'Provide metadata for your submission; moderators will review mock entries.',
    'paperAdd.title': 'Title',
    'paperAdd.abstract': 'Abstract',
    'paperAdd.year': 'Year',
    'paperAdd.pdfSource': 'PDF/Source URL',
    'paperAdd.related': 'Related Papers',
    'paperAdd.referenced': 'Referenced Papers',
    'paperAdd.errNoTitle': 'Please provide a title',
    'paperAdd.okSubmitted': 'Paper submitted for moderation',
    'paperAdd.errSubmit': 'Failed to submit paper (mock/draft)',
    'paperAdd.toMyPapers': 'Go to My Papers',
    'paperAdd.metaHeader': 'Basics',
    'paperAdd.metaHint': 'Add the core information reviewers need for context.',
    'paperAdd.stepBasics': 'Step 1',
    'paperAdd.stepRelated': 'Step 2',
    'paperAdd.stepReferences': 'Step 3',
    'paperAdd.placeholderTitle': 'Enter a clear, descriptive title',
    'paperAdd.placeholderAbstract': 'Brief, 2–3 sentence abstract describing your paper',
    'paperAdd.placeholderUrl': 'https://example.com/paper.pdf',
    'paperAdd.relatedHint': 'List papers that overlap with or inspired this submission.',
    'paperAdd.noRelated': 'No related papers added yet.',
    'paperAdd.referencedHint': 'Include works that your paper cites directly.',
    'paperAdd.noReferenced': 'No referenced papers added yet.',
    'paperAdd.idPlaceholder': 'Enter paper ID or DOI',
    'paperAdd.sidebar.title': 'Before you submit',
    'paperAdd.sidebar.tip1': 'Ensure the title is unique and accurately reflects the paper.',
    'paperAdd.sidebar.tip2': 'Link to a stable PDF or source so moderators can verify your work.',
    'paperAdd.sidebar.tip3': 'Adding related and referenced IDs helps speed up moderation.',
    'paperAdd.sidebar.help': 'You can edit the submission while the status remains pending.',

    'papers.title': 'My Papers',
    'papers.subtitle': 'Track the moderation status of your submissions (mock data).',
    'papers.updatedAt': 'Updated',
    'papers.submittedAt': 'Submitted',
    'papers.statusLabel': 'Status',
    'papers.moderatorComment': 'Moderator comment',
    'papers.noModeratorComment': 'No moderator comments yet.',
    'papers.action.edit': 'Edit submission',
    'papers.action.viewPublic': 'Open public page',
    'papers.action.back': 'Back',
    'papers.empty': 'You have not submitted any papers yet.',
    'papers.status.draft': 'Draft',
    'papers.status.pending': 'Pending review',
    'papers.status.rejected': 'Rejected',
    'papers.status.approved': 'Approved',
    'papers.errNotFound': 'Submission not found',
    'papers.errNotEditable': 'This submission cannot be edited because it is already approved.',
    'papers.errSave': 'Failed to save changes (mock).',
    'papers.okSaved': 'Changes saved locally.',

    'paperEdit.title': 'Edit submission',
    'paperEdit.statusLabel': 'Current status:',
    'paperEdit.readonly': 'Approved submissions are read-only.',
    'paperEdit.notFoundHint': 'Try returning to the list and selecting another submission.',

    'common.add': 'Add',
    'common.remove': 'Remove',
    'common.submit': 'Submit',
    'common.submitting': 'Submitting…',
    'common.refresh': 'Refresh',
    'common.loading': 'Loading…',
    'common.edit': 'Edit',
    'common.cancel': 'Cancel',
    'common.save': 'Save',
    'common.apply': 'Apply',
    'common.delete': 'Delete',
    'common.reset': 'Reset',

    'admin.title': 'Admin Panel',
    'admin.toModerator': 'Moderator Panel',
    'admin.users': 'Users',
    'admin.noUsers': 'No users',
    'admin.errFetch': 'Failed to fetch users',
    'admin.columns.email': 'Email',
    'admin.columns.first': 'First name',
    'admin.columns.last': 'Last name',
    'admin.columns.locale': 'Locale',
    'admin.columns.confirmed': 'Confirmed',
    'admin.columns.photo': 'Photo',
    'admin.columns.roles': 'Roles',
    'admin.columns.password': 'Password',
    'admin.filters.search': 'Search',
    'admin.filters.role': 'Role',
    'admin.filters.locale': 'Locale',
    'admin.filters.confirmed': 'Email confirmed',
    'admin.filters.limit': 'Page size',
    'admin.filters.apply': 'Apply filters',
    'admin.filters.reset': 'Reset',
    'admin.pager.prev': 'Prev',
    'admin.pager.next': 'Next',
    'admin.pager.pageOf': 'Page {page} of {pages}',
    'admin.pager.total': 'Total: {total}',

    'mod.title': 'Moderator Panel',
    'mod.draftNote': 'Draft version using mock data',
    'mod.status.pending': 'Pending',
    'mod.status.approved': 'Approved',
    'mod.status.rejected': 'Rejected',
    'mod.noItems': 'No papers to moderate',
    'mod.meta.author': 'Author',

    'chat.status.searching': 'Searching...',
    'chat.error.enterQuery': 'Enter a query to search.',
    'chat.error.noResults': 'No results matched your query.',
    'chat.error.failed': 'Search failed. Please try again.',
    'chat.empty': 'Start a new search to see results here.',
    'chat.noResultsForTurn': 'No results captured for this query.',
    'chat.openAccess': 'Open Access',
    'chat.preview.year': 'Year',
    'chat.preview.source': 'Source',
    'chat.link.openPdf': 'Open PDF',
    'chat.link.articlePage': 'Article page',
    'chat.input.search': 'Search',
    'chat.input.searching': 'Searching...',
    'chat.input.blocked': 'Blocked',
    'chat.input.placeholder': 'e.g. interpretable machine learning',
    'chat.blockedNote': 'Search disabled for Admin/Moderator',
    'chat.untitled': 'Untitled paper',
    'chat.noAbstract': 'No abstract available.',

    'auth.login': 'Log in',
    'auth.signup': 'Sign up',
    'auth.email': 'Email',
    'auth.password': 'Password',
    'auth.confirmPassword': 'Confirm Password',
    'auth.firstname': 'Firstname',
    'auth.lastname': 'Lastname',
    'auth.forgot': 'Forgot Password?',
    'auth.resetEmailRequired': 'Please enter your email first.',
    'auth.resetSuccess': 'If the email exists, we sent password reset instructions.',
    'auth.resetFailed': 'Could not send reset instructions. Try again later.',
    'auth.resetTitle': 'Reset password',
    'auth.resetDescription': 'Enter your email and we will send a reset link if the account exists.',
    'auth.resetSubmit': 'Send reset link',
    'auth.resetCancel': 'Cancel',
    'auth.resetClose': 'Close',
    'auth.continueGoogle': 'Continue with Google',
    'auth.continueYandex': 'Continue with Yandex',
    'auth.noAccount': "Don't have an account?",
    'auth.haveAccount': 'Already have an account?',
    'auth.createOne': 'Create one',
    'auth.signIn': 'Sign in',

    'notFound.title': '404 - Page Not Found',
    'notFound.desc': 'The page you are looking for does not exist.',
    'notFound.home': 'Go back to Home',

    'footer.copy': '© 2025 LiveisFPV Dev. All rights reserved.',

    'paper.viewTitle': 'Paper View',

    'search.title': 'Search View',
    'search.placeholder': 'This is a placeholder page.',

    'profile.title': 'Your profile',
    'profile.emailConfirmed': 'Email confirmed',
    'profile.locale': 'Locale',
    'profile.roles': 'Roles',
    'profile.form.firstName': 'First name',
    'profile.form.lastName': 'Last name',
    'profile.form.locale': 'Locale (e.g. en, ru)',
    'profile.form.newPassword': 'New password',
    'profile.form.keepBlank': 'Leave blank to keep',
    'profile.btn.cancel': 'Cancel',
    'profile.btn.save': 'Save changes',
    'profile.saving': 'Saving...',
    'profile.btn.edit': 'Edit profile',
    'profile.btn.logout': 'Log out',
    'profile.msg.nothing': 'Nothing to update',
    'profile.msg.updated': 'Profile updated',
    'profile.msg.failed': 'Failed to update profile',
    'common.yes': 'Yes',
    'common.no': 'No',
  },
  ru: {
    'nav.addPaper': 'Добавить статью',
    'nav.myPapers': 'Мои статьи',
    'nav.moderation': 'Модерация',
    'nav.adminPanel': 'Админ-панель',
    'nav.newSearch': 'Новый поиск',
    'nav.searchChats': 'Поиск по чатам',
    'nav.history': 'История',
    'nav.settings': 'Настройки',
    'nav.noChats': 'Пока нет чатов. Начните новый поиск.',

    'settings.title': 'Настройки',
    'settings.appearance': 'Оформление',
    'settings.dark': 'Тёмная тема',
    'settings.light': 'Светлая тема',
    'settings.sidebar': 'Боковая панель',
    'settings.hideLeft': 'Скрывать левую панель',
    'settings.language': 'Язык',
    'settings.langEnglish': 'Английский',
    'settings.langRussian': 'Русский',

    'paperAdd.header': 'Добавление статьи',
    'paperAdd.subtitle': 'Заполните данные статьи — заявка появится в разделе «Мои статьи».',
    'paperAdd.title': 'Заголовок',
    'paperAdd.abstract': 'Аннотация',
    'paperAdd.year': 'Год',
    'paperAdd.pdfSource': 'Ссылка на PDF/источник',
    'paperAdd.related': 'Связанные статьи',
    'paperAdd.referenced': 'Ссылаемые статьи',
    'paperAdd.errNoTitle': 'Укажите заголовок статьи',
    'paperAdd.okSubmitted': 'Статья отправлена на модерацию',
    'paperAdd.errSubmit': 'Не удалось отправить статью (мок/черновик)',
    'paperAdd.toMyPapers': 'Перейти к «Мои статьи»',
    'paperAdd.metaHeader': 'Основные данные',
    'paperAdd.metaHint': 'Укажите ключевую информацию, которая поможет модераторам.',
    'paperAdd.stepBasics': 'Шаг 1',
    'paperAdd.stepRelated': 'Шаг 2',
    'paperAdd.stepReferences': 'Шаг 3',
    'paperAdd.placeholderTitle': 'Введите понятный и ёмкий заголовок',
    'paperAdd.placeholderAbstract': 'Краткое описание или аннотация (2–3 предложения)',
    'paperAdd.placeholderUrl': 'https://example.com/paper.pdf',
    'paperAdd.relatedHint': 'Добавьте работы, которые пересекаются с заявкой или вдохновили её.',
    'paperAdd.noRelated': 'Связанных статей пока нет.',
    'paperAdd.referencedHint': 'Укажите статьи, на которые вы ссылаетесь напрямую.',
    'paperAdd.noReferenced': 'Ссылаемых статей пока нет.',
    'paperAdd.idPlaceholder': 'Укажите ID или DOI статьи',
    'paperAdd.sidebar.title': 'Перед отправкой',
    'paperAdd.sidebar.tip1': 'Проверьте, что заголовок уникален и точно отражает содержание.',
    'paperAdd.sidebar.tip2': 'Укажите стабильную ссылку на PDF или источник для проверки модераторами.',
    'paperAdd.sidebar.tip3': 'Связанные и ссылаемые ID ускоряют модерацию и каталогизацию.',
    'paperAdd.sidebar.help':
      'Пока статус заявки «На модерации», вы можете вносить изменения в данные.',

    'papers.title': 'Мои статьи',
    'papers.subtitle': 'Следите за статусом рассмотрения отправленных материалов (моки).',
    'papers.updatedAt': 'Обновлено',
    'papers.submittedAt': 'Отправлено',
    'papers.statusLabel': 'Статус',
    'papers.moderatorComment': 'Комментарий модератора',
    'papers.noModeratorComment': 'Комментариев модератора пока нет.',
    'papers.action.edit': 'Редактировать заявку',
    'papers.action.viewPublic': 'Открыть публичную страницу',
    'papers.action.back': 'Назад',
    'papers.empty': 'Вы еще не добавили ни одной статьи.',
    'papers.status.draft': 'Черновик',
    'papers.status.pending': 'На модерации',
    'papers.status.rejected': 'Отклонена',
    'papers.status.approved': 'Одобрена',
    'papers.errNotFound': 'Заявка не найдена',
    'papers.errNotEditable': 'Статью нельзя редактировать, потому что она уже одобрена.',
    'papers.errSave': 'Не удалось сохранить изменения (моки).',
    'papers.okSaved': 'Изменения сохранены локально.',

    'paperEdit.title': 'Редактирование заявки',
    'paperEdit.statusLabel': 'Текущий статус:',
    'paperEdit.readonly': 'Одобренные заявки доступны только для просмотра.',
    'paperEdit.notFoundHint': 'Вернитесь к списку и выберите другую статью.',

    'common.add': 'Добавить',
    'common.remove': 'Удалить',
    'common.submit': 'Отправить',
    'common.submitting': 'Отправка…',
    'common.refresh': 'Обновить',
    'common.loading': 'Загрузка…',
    'common.edit': 'Редактировать',
    'common.cancel': 'Отмена',
    'common.save': 'Сохранить',
    'common.apply': 'Применить',
    'common.delete': 'Удалить',
    'common.reset': 'Сбросить',

    'admin.title': 'Панель администратора',
    'admin.toModerator': 'Панель модератора',
    'admin.users': 'Пользователи',
    'admin.noUsers': 'Нет пользователей',
    'admin.errFetch': 'Не удалось получить список пользователей',
    'admin.columns.email': 'Email',
    'admin.columns.first': 'Имя',
    'admin.columns.last': 'Фамилия',
    'admin.columns.locale': 'Язык',
    'admin.columns.confirmed': 'Подтв. email',
    'admin.columns.photo': 'Фото',
    'admin.columns.roles': 'Роли',
    'admin.columns.password': 'Пароль',
    'admin.filters.search': 'Поиск',
    'admin.filters.role': 'Роль',
    'admin.filters.locale': 'Язык',
    'admin.filters.confirmed': 'Email подтверждён',
    'admin.filters.limit': 'Размер страницы',
    'admin.filters.apply': 'Применить фильтры',
    'admin.filters.reset': 'Сбросить',
    'admin.pager.prev': 'Назад',
    'admin.pager.next': 'Вперёд',
    'admin.pager.pageOf': 'Стр. {page} из {pages}',
    'admin.pager.total': 'Всего: {total}',

    'mod.title': 'Панель модератора',
    'mod.draftNote': 'Черновая версия на мок-данных',
    'mod.status.pending': 'На рассмотрении',
    'mod.status.approved': 'Одобрено',
    'mod.status.rejected': 'Отклонено',
    'mod.noItems': 'Нет статей для модерации',
    'mod.meta.author': 'Автор',

    'chat.status.searching': 'Поиск…',
    'chat.error.enterQuery': 'Введите запрос для поиска.',
    'chat.error.noResults': 'Ничего не найдено по запросу.',
    'chat.error.failed': 'Ошибка поиска. Попробуйте ещё раз.',
    'chat.empty': 'Начните новый поиск, чтобы увидеть результаты.',
    'chat.noResultsForTurn': 'Для этого запроса нет результатов.',
    'chat.openAccess': 'Open Access',
    'chat.preview.year': 'Год',
    'chat.preview.source': 'Источник',
    'chat.link.openPdf': 'Открыть PDF',
    'chat.link.articlePage': 'Страница статьи',
    'chat.input.search': 'Поиск',
    'chat.input.searching': 'Поиск…',
    'chat.input.blocked': 'Заблокировано',
    'chat.input.placeholder': 'например, interpretable machine learning',
    'chat.blockedNote': 'Поиск недоступен для ролей Админ/Модератор',
    'chat.untitled': 'Без названия',
    'chat.noAbstract': 'Нет аннотации.',

    'auth.login': 'Войти',
    'auth.signup': 'Зарегистрироваться',
    'auth.email': 'Email',
    'auth.password': 'Пароль',
    'auth.confirmPassword': 'Подтвердите пароль',
    'auth.firstname': 'Имя',
    'auth.lastname': 'Фамилия',
    'auth.forgot': 'Забыли пароль?',
    'auth.resetEmailRequired': 'Введите email, чтобы сбросить пароль.',
    'auth.resetSuccess': 'Если такой email существует, мы отправили инструкции по восстановлению.',
    'auth.resetFailed': 'Не удалось отправить письмо. Попробуйте позже.',
    'auth.resetTitle': 'Восстановление пароля',
    'auth.resetDescription': 'Введите email, и мы отправим ссылку для восстановления, если аккаунт существует.',
    'auth.resetSubmit': 'Отправить ссылку',
    'auth.resetCancel': 'Отмена',
    'auth.resetClose': 'Закрыть',
    'auth.continueGoogle': 'Войти через Google',
    'auth.continueYandex': 'Войти через Яндекс',
    'auth.noAccount': 'Нет аккаунта?',
    'auth.haveAccount': 'Уже есть аккаунт?',
    'auth.createOne': 'Создать',
    'auth.signIn': 'Войти',

    'notFound.title': '404 - Страница не найдена',
    'notFound.desc': 'Страница, которую вы ищете, не существует.',
    'notFound.home': 'Вернуться на главную',

    'footer.copy': '© 2025 LiveisFPV Dev. Все права защищены.',

    'paper.viewTitle': 'Статья',

    'search.title': 'Поиск',
    'search.placeholder': 'Временная страница-заглушка.',

    'profile.title': 'Ваш профиль',
    'profile.emailConfirmed': 'Email подтверждён',
    'profile.locale': 'Язык',
    'profile.roles': 'Роли',
    'profile.form.firstName': 'Имя',
    'profile.form.lastName': 'Фамилия',
    'profile.form.locale': 'Язык (например, en, ru)',
    'profile.form.newPassword': 'Новый пароль',
    'profile.form.keepBlank': 'Оставьте пустым, чтобы не менять',
    'profile.btn.cancel': 'Отмена',
    'profile.btn.save': 'Сохранить изменения',
    'profile.saving': 'Сохранение…',
    'profile.btn.edit': 'Редактировать профиль',
    'profile.btn.logout': 'Выйти',
    'profile.msg.nothing': 'Нечего обновлять',
    'profile.msg.updated': 'Профиль обновлён',
    'profile.msg.failed': 'Не удалось обновить профиль',
    'common.yes': 'Да',
    'common.no': 'Нет',
  },
}

export function t(key: string): string {
  const l = locale.value
  return (messages[l] && messages[l][key]) ?? messages.en[key] ?? key
}

export function useI18n() {
  return { locale, setLocale, t, messages }
}
